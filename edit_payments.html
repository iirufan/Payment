<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Booking Management System</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    --primary: #4361ee;
    --primary-light: #4895ef;
    --secondary: #3f37c9;
    --success: #4cc9f0;
    --danger: #f72585;
    --warning: #f8961e;
    --info: #4895ef;
    --light: #f8f9fa;
    --dark: #212529;
    --gray: #6c757d;
    --light-gray: #e9ecef;
    --border: #dee2e6;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    --radius: 10px;
    --transition: all 0.3s ease;
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
    color: var(--dark);
    line-height: 1.6;
    padding: 20px;
    min-height: 100vh;
  }

  .container {
    max-width: 1600px;
    margin: 0 auto;
  }

  .header {
    text-align: center;
    margin-bottom: 30px;
    padding: 25px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    color: white;
  }

  .header h2 {
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
  }

  .header p {
    opacity: 0.9;
    font-size: 16px;
  }

  .dashboard-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .card {
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 20px;
    display: flex;
    flex-direction: column;
  }

  .card-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(67, 97, 238, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 15px;
    color: var(--primary);
    font-size: 20px;
  }

  .card-title {
    font-size: 14px;
    color: var(--gray);
    margin-bottom: 8px;
  }

  .card-value {
    font-size: 28px;
    font-weight: 700;
    color: var(--dark);
  }

  .card-change {
    font-size: 12px;
    margin-top: 5px;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .positive {
    color: #2ecc71;
  }

  .negative {
    color: #e74c3c;
  }

  .controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 20px;
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    flex-wrap: wrap;
    gap: 15px;
  }

  .search-container {
    display: flex;
    align-items: center;
    gap: 10px;
    position: relative;
  }

  .search-container label {
    font-weight: 600;
    color: var(--dark);
    white-space: nowrap;
  }

  .search-container input {
    padding: 12px 15px 12px 40px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 16px;
    transition: var(--transition);
    width: 250px;
  }

  .search-container input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
  }

  .search-icon {
    position: absolute;
    left: 15px;
    color: var(--gray);
  }

  .btn {
    padding: 12px 20px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: var(--radius);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .btn:hover {
    background: var(--secondary);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .btn-success {
    background: var(--success);
  }

  .btn-success:hover {
    background: #3aafd9;
  }

  .btn-danger {
    background: var(--danger);
  }

  .btn-danger:hover {
    background: #e31272;
  }

  .btn-warning {
    background: var(--warning);
  }

  .btn-warning:hover {
    background: #e6891c;
  }

  .btn-info {
    background: var(--info);
  }

  .btn-info:hover {
    background: #3a87e6;
  }

  .bookings-container {
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    margin-bottom: 30px;
  }

  .bookings-header {
    background: var(--primary);
    color: white;
    padding: 15px 20px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .bookings-header-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .filter-controls {
    display: flex;
    gap: 10px;
  }

  .filter-btn {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    cursor: pointer;
    transition: var(--transition);
  }

  .filter-btn:hover, .filter-btn.active {
    background: white;
    color: var(--primary);
  }

  .bookings-content {
    padding: 20px;
    overflow-x: auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }

  th, td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }

  th {
    background: var(--light);
    font-weight: 600;
    color: var(--dark);
    position: sticky;
    top: 0;
    cursor: pointer;
  }

  th:hover {
    background: var(--light-gray);
  }

  th i {
    margin-left: 5px;
    font-size: 12px;
    opacity: 0.7;
  }

  tr:hover {
    background: #f8f9fa;
  }

  .voided-row {
    background-color: #fff5f7;
  }

  .status-badge {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }

  .status-active {
    background: #e8f5e8;
    color: #2e7d32;
  }

  .status-voided {
    background: #ffebee;
    color: #c62828;
  }

  .status-pending {
    background: #fff8e1;
    color: #f57c00;
  }

  .action-buttons {
    display: flex;
    gap: 8px;
  }

  .action-btn {
    padding: 8px 12px;
    border: none;
    border-radius: var(--radius);
    font-size: 12px;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .btn-edit {
    background: var(--primary-light);
    color: white;
  }

  .btn-edit:hover {
    background: var(--primary);
  }

  .btn-delete {
    background: var(--danger);
    color: white;
  }

  .btn-delete:hover {
    background: #e31272;
  }

  .btn-void {
    background: var(--warning);
    color: white;
  }

  .btn-void:hover {
    background: #e6891c;
  }

  .btn-view {
    background: var(--info);
    color: white;
  }

  .btn-view:hover {
    background: #3a87e6;
  }

  .loading {
    text-align: center;
    padding: 40px;
    color: var(--gray);
  }

  .loading i {
    font-size: 36px;
    margin-bottom: 15px;
    color: var(--primary);
  }

  .empty-state {
    text-align: center;
    padding: 50px;
    color: var(--gray);
  }

  .empty-state i {
    font-size: 56px;
    margin-bottom: 15px;
    color: #dfe6e9;
  }

  .empty-state p {
    font-size: 18px;
    margin-bottom: 20px;
  }

  .pagination {
    display: flex;
    justify-content: center;
    margin-top: 20px;
    gap: 8px;
  }

  .pagination-btn {
    padding: 8px 14px;
    background: white;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    cursor: pointer;
    transition: var(--transition);
  }

  .pagination-btn:hover {
    background: var(--light);
  }

  .pagination-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }

  .modal-content {
    background: white;
    border-radius: var(--radius);
    width: 90%;
    max-width: 600px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    overflow: hidden;
  }

  .modal-header {
    background: var(--primary);
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-header h3 {
    font-weight: 600;
  }

  .close-modal {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
  }

  .modal-body {
    padding: 20px;
  }

  .form-group {
    margin-bottom: 15px;
  }

  .form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: var(--dark);
  }

  .form-group input, .form-group select {
    width: 100%;
    padding: 10px 15px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 16px;
  }

  .form-row {
    display: flex;
    gap: 15px;
  }

  .form-row .form-group {
    flex: 1;
  }

  .modal-footer {
    padding: 15px 20px;
    background: var(--light);
    display: flex;
    justify-content: flex-end;
    gap: 10px;
  }

  @media (max-width: 1024px) {
    .dashboard-cards {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .controls {
      flex-direction: column;
      align-items: stretch;
    }
    
    .search-container {
      flex-direction: column;
      align-items: stretch;
    }
    
    .search-container input {
      width: 100%;
    }
    
    .action-buttons {
      flex-wrap: wrap;
    }
    
    table {
      font-size: 12px;
    }
    
    th, td {
      padding: 10px;
    }
    
    .dashboard-cards {
      grid-template-columns: 1fr;
    }
    
    .bookings-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 15px;
    }
    
    .filter-controls {
      flex-wrap: wrap;
    }
    
    .form-row {
      flex-direction: column;
      gap: 0;
    }
  }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h2><i class="fas fa-calendar-check"></i> Payment Management System</h2>
    <p>View, edit, and manage all Payment receipts in one place</p>
  </div>

  

  <div class="controls">
    <div class="search-container">
      <label for="searchReceipt">Search Bookings:</label>
      <i class="fas fa-search search-icon"></i>
      <input type="number" id="searchReceipt" placeholder="Enter Receipt Number">
      <button id="searchBtn" class="btn">
        <i class="fas fa-search"></i> Search
      </button>
    </div>
    <div>
      
      <button id="loadAllBtn" class="btn btn-success">
        <i class="fas fa-sync-alt"></i> Refresh
      </button>
    </div>
  </div>

  <div class="bookings-container">
    <div class="bookings-header">
      <div class="bookings-header-left">
        <i class="fas fa-list"></i>
        <span>Bookings List</span>
      </div>
      <div class="filter-controls">
        <button class="filter-btn active">All</button>
        
      </div>
    </div>
    <div class="bookings-content">
      <div id="bookingsDiv">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading bookings...</p>
        </div>
      </div>
      <div class="pagination">
        <button class="pagination-btn"><i class="fas fa-chevron-left"></i></button>
        <button class="pagination-btn active">1</button>
        <button class="pagination-btn">2</button>
        <button class="pagination-btn">3</button>
        <button class="pagination-btn"><i class="fas fa-chevron-right"></i></button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="viewModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-receipt"></i> Booking Details</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Receipt Number</label>
          <input type="text" value="1042" readonly>
        </div>
        <div class="form-group">
          <label>Booking Date</label>
          <input type="text" value="2023-10-15" readonly>
        </div>
      </div>
      <div class="form-group">
        <label>Customer Name</label>
        <input type="text" value="John Smith" readonly>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Flight Number</label>
          <input type="text" value="AA 245" readonly>
        </div>
        <div class="form-group">
          <label>Seat Number</label>
          <input type="text" value="24C" readonly>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Adults</label>
          <input type="text" value="2" readonly>
        </div>
        <div class="form-group">
          <label>Children</label>
          <input type="text" value="1" readonly>
        </div>
        <div class="form-group">
          <label>Total Amount</label>
          <input type="text" value="$425.00" readonly>
        </div>
      </div>
      <div class="form-group">
        <label>Payment Method</label>
        <input type="text" value="Credit Card" readonly>
      </div>
      <div class="form-group">
        <label>Status</label>
        <input type="text" value="Active" readonly>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-warning"><i class="fas fa-print"></i> Print</button>
      <button class="btn btn-edit"><i class="fas fa-edit"></i> Edit</button>
      <button class="btn" style="background: var(--gray);">Close</button>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="fire2.js"></script>

<script>
const bookingsDiv = document.getElementById("bookingsDiv");
const searchReceipt = document.getElementById("searchReceipt");
const searchBtn = document.getElementById("searchBtn");
const loadAllBtn = document.getElementById("loadAllBtn");
const viewModal = document.getElementById("viewModal");
const closeModal = document.querySelector(".close-modal");

// Fetch and display bookings
async function loadBookings(query = null) {
  bookingsDiv.innerHTML = `
    <div class="loading">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Loading bookings...</p>
    </div>
  `;
  
  let snapshot;
  try {
    if(query){
      snapshot = await db.collection("payments")
                         .where("receiptNo", "==", parseInt(query))
                         .get();
    } else {
      snapshot = await db.collection("payments")
                         .orderBy("timestamp", "desc")
                         .get();
    }

    if(snapshot.empty){
      bookingsDiv.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-receipt"></i>
          <p>No bookings found.</p>
          <button class="btn" onclick="loadBookings()"><i class="fas fa-sync"></i> Try Again</button>
        </div>
      `;
      return;
    }

    let html = `<table>
      <thead>
        <tr>
          <th>Receipt No <i class="fas fa-sort"></i></th>
          <th>Date <i class="fas fa-sort"></i></th>
          <th>Name</th>
          <th>Flight</th>
          <th>Seat</th>
          <th>Adults</th>
          <th>Kids</th>
          <th>Total <i class="fas fa-sort"></i></th>
          <th>Payment</th>
          <th>Status <i class="fas fa-sort"></i></th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>`;

    snapshot.docs.forEach(doc => {
      const data = doc.data();
      const voidedClass = data.voided ? "voided-row" : "";
      const statusClass = data.voided ? "status-voided" : "status-active";
      const statusText = data.voided ? "VOID" : "Active";
      
      html += `
      <tr class="${voidedClass}">
        <td>${data.receiptNo}</td>
        <td>${data.date || '-'}</td>
        <td>${data.name || '-'}</td>
        <td>${data.flight || '-'}</td>
        <td>${data.seat || '-'}</td>
        <td>${data.adults || '0'}</td>
        <td>${data.kids || '0'}</td>
        <td>${data.total ? data.total.toFixed(2) : '0.00'} ${data.currency || ''}</td>
        <td>${data.paymentType || '-'}</td>
        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
        <td>
          <div class="action-buttons">
            <button onclick="viewBooking('${doc.id}')" class="action-btn btn-view">
              <i class="fas fa-eye"></i> View
            </button>
            <button onclick="editBooking('${doc.id}')" class="action-btn btn-edit">
              <i class="fas fa-edit"></i> Edit
            </button>
            ${!data.voided ? `
            <button onclick="voidBooking('${doc.id}')" class="action-btn btn-void">
              <i class="fas fa-ban"></i> Void
            </button>
            ` : ''}
          </div>
        </td>
      </tr>`;
    });

    html += `</tbody></table>`;
    bookingsDiv.innerHTML = html;
  } catch(err){
    console.error(err);
    bookingsDiv.innerHTML = `
      <div style="color: #e74c3c; text-align: center; padding: 20px;">
        <i class="fas fa-exclamation-circle"></i>
        <p>Error loading bookings: ${err.message}</p>
        <button class="btn" onclick="loadBookings()"><i class="fas fa-sync"></i> Try Again</button>
      </div>
    `;
  }
}

// View booking details
function viewBooking(docId) {
  viewModal.style.display = "flex";
}

// Edit booking
async function editBooking(docId){
  const docRef = db.collection("payments").doc(docId);
  const docSnap = await docRef.get();
  if(!docSnap.exists){ 
    alert("Booking not found!"); 
    return; 
  }
  const data = docSnap.data();

  const newName = prompt("Name:", data.name || '');
  if(newName === null) return;
  
  const newFlight = prompt("Flight:", data.flight || '');
  if(newFlight === null) return;
  
  const newSeat = prompt("Seat:", data.seat || '');
  if(newSeat === null) return;
  
  const newAdults = prompt("Adults:", data.adults || '0');
  if(newAdults === null) return;
  
  const newKids = prompt("Kids:", data.kids || '0');
  if(newKids === null) return;
  
  const newPayment = prompt("Payment Type (Cash/Card):", data.paymentType || '');
  if(newPayment === null) return;

  try{
    await docRef.update({
      name: newName,
      flight: newFlight,
      seat: newSeat,
      adults: parseInt(newAdults),
      kids: parseInt(newKids),
      paymentType: newPayment
    });
    alert("Booking updated successfully!");
    loadBookings();
  } catch(err){
    alert("Error updating booking: " + err.message);
  }
}

// Void booking
async function voidBooking(docId){
  const reason = prompt("Enter reason for voiding this booking:");
  if(!reason) return;
  try{
    await db.collection("payments").doc(docId).update({
      voided: true,
      voidReason: reason
    });
    alert("Booking voided successfully!");
    loadBookings();
  } catch(err){
    alert("Error voiding booking: " + err.message);
  }
}

// Event listeners
searchBtn.addEventListener("click", () => {
  if (searchReceipt.value) {
    loadBookings(searchReceipt.value);
  } else {
    alert("Please enter a receipt number to search");
  }
});

loadAllBtn.addEventListener("click", () => {
  searchReceipt.value = "";
  loadBookings();
});

closeModal.addEventListener("click", () => {
  viewModal.style.display = "none";
});

// Close modal when clicking outside
window.addEventListener("click", (e) => {
  if (e.target === viewModal) {
    viewModal.style.display = "none";
  }
});

// Load all bookings on page load
window.addEventListener("DOMContentLoaded", () => loadBookings());
</script>
</body>
</html>
